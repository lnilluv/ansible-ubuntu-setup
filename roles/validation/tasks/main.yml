- name: Verify tailscale interface has IPv4 address
  ansible.builtin.command: tailscale ip -4
  register: tailscale_ip
  changed_when: false

- name: Ensure tailscale IPv4 is present
  ansible.builtin.assert:
    that:
      - tailscale_ip.stdout is match('^[0-9]+\\.[0-9]+\\.[0-9]+\\.[0-9]+$')

- name: Verify ufw is active
  ansible.builtin.command: ufw status
  register: ufw_status
  changed_when: false

- name: Assert ufw allows tailscale ssh rule
  ansible.builtin.assert:
    that:
      - "'tailscale0' in ufw_status.stdout"
      - "(ssh_port | string) in ufw_status.stdout"
